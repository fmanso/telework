@using TeleworkApp.Data
@using TeleworkApp.Services

<div class="calendario-trimestre">
    <div class="calendario-trimestre-header">
        <button class="btn btn-outline-secondary btn-sm" @onclick="PreviousQuarter">&lt;</button>
        <h4>@QuarterName @Year</h4>
        <button class="btn btn-outline-secondary btn-sm" @onclick="NextQuarter">&gt;</button>
    </div>

    <div class="calendario-trimestre-grid">
        <MonthCalendar 
            Year="@Year" 
            Month="@Month1"
            Compact="true"
            WorkDays="@WorkDays"
            Holidays="@Holidays"
            OnDayClicked="@OnDayClicked" />

        <MonthCalendar 
            Year="@Year" 
            Month="@Month2"
            Compact="true"
            WorkDays="@WorkDays"
            Holidays="@Holidays"
            OnDayClicked="@OnDayClicked" />

        <MonthCalendar 
            Year="@Year" 
            Month="@Month3"
            Compact="true"
            WorkDays="@WorkDays"
            Holidays="@Holidays"
            OnDayClicked="@OnDayClicked" />
    </div>

    <div class="calendario-leyenda">
        <div class="leyenda-item">
            <span class="leyenda-color oficina"></span>
            <span>Office</span>
        </div>
        <div class="leyenda-item">
            <span class="leyenda-color casa"></span>
            <span>Home</span>
        </div>
        <div class="leyenda-item">
            <span class="leyenda-color ausencia"></span>
            <span>Absence</span>
        </div>
        <div class="leyenda-item">
            <span class="leyenda-color festivo"></span>
            <span>Holiday</span>
        </div>
    </div>
</div>

@code {
    [Parameter] public int Year { get; set; }
    [Parameter] public int Quarter { get; set; }
    [Parameter] public EventCallback<(int Year, int Quarter)> OnQuarterChanged { get; set; }
    [Parameter] public EventCallback<DateOnly> OnDayClicked { get; set; }
    [Parameter] public List<WorkDay> WorkDays { get; set; } = new();
    [Parameter] public List<Holiday> Holidays { get; set; } = new();

    private int Month1 => (Quarter - 1) * 3 + 1;
    private int Month2 => Month1 + 1;
    private int Month3 => Month1 + 2;

    private string QuarterName => Quarter switch
    {
        1 => "Q1 (Jan-Mar)",
        2 => "Q2 (Apr-Jun)",
        3 => "Q3 (Jul-Sep)",
        4 => "Q4 (Oct-Dec)",
        _ => ""
    };

    private async Task PreviousQuarter()
    {
        int newQuarter = Quarter - 1;
        int newYear = Year;

        if (newQuarter < 1)
        {
            newQuarter = 4;
            newYear--;
        }

        await OnQuarterChanged.InvokeAsync((newYear, newQuarter));
    }

    private async Task NextQuarter()
    {
        int newQuarter = Quarter + 1;
        int newYear = Year;

        if (newQuarter > 4)
        {
            newQuarter = 1;
            newYear++;
        }

        await OnQuarterChanged.InvokeAsync((newYear, newQuarter));
    }
}
